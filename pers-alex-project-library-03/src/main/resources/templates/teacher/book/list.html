<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head lang="en" th:replace="main/public :: #publicHead">

</head>
<body>
<!--头部-->
<header class="publicHeader" th:replace="main/public :: .publicHeader">
</header>
<!--时间-->
<section class="publicTime" th:replace="main/public :: .publicTime">
</section>
<!--主体内容-->
<section class="publicMian ">
    <div class="left" th:replace="main/public :: .left(menuSelect = 'manage')">
    </div>
    <div class="right">
        <div class="location">
            <strong>你现在所在的位置是:</strong>
            <span>图书管理页面</span>
        </div>
        <form id="bookListForm">
            <div class="search">
                <span>书籍名称：</span>
                <input type="text" name="sBookName" placeholder="请输入书籍的名称"/>
                <input type="button" value="查询" onclick="search();"/>
                <a th:href="@{/teacher/books/add}">新增书籍</a>
                <select id="sBookSort" name="sBookSort"></select>
            </div>
        </form>
        <table id="bookTable" class="layui-table">
        </table>
    </div>
</section>
<footer class="footer" th:replace="main/public :: .footer">
</footer>

<script th:src="@{/webjars/jquery/3.4.1/jquery.js}"></script>
<script th:src="@{/js/time.js}"></script>
<span th:include="main/baseurl :: html"></span>
<script th:inline="javascript">
    $(function(){
        var bookListTable;
        var options;
        var BOOK_SORT_URL = getBaseUrl()+'/booksort';
        var BOOK_LIST_URL = getBaseUrl()+'/books/get';
        var BOOK_SEARCH_URL = getBaseUrl()+'/book/search';
        bootPage = function(){
            registerEvent();
            loadTable();
        };
        registerEvent = function(){
            $.ajax({
                url: BOOK_SORT_URL,
                type: 'get',
                success: function(result) {
                    if(result && result.length >= 0){
                        $('#sBookSort').append("<option value=''>书籍分类</option>");
                        result.forEach(function(val,ind){
                            $('#sBookSort').append("<option value='"+val["sSortId"]+"'>"+val["sSortName"]+"</option>");
                        });
                    }
                }
            });
        },
        loadTable = function(){
            layui.use("table",function(){
                bookListTable = layui.table;
                var cols = [
                    {field: 'sBookId',title:'书籍编号'},
                    {field: 'sBookName',title:'书名'},
                    {field: 'sBookAuthor',title:'作者'},
                    {field: 'sBookPub',title:'出版社'},
                    {field: 'sSortName',title:'书籍类别'},
                    {field: 'sBookRecord',title:'登记时间'},
                    {
                        field: 'sBookId',
                        title:'操作',
                        align: 'center',
                        templet:function (d) {
                            return  '<div>'+
                                        '<a href="'+getBaseUrl()+'/teacher/book/' + d.sBookId + '?type=view' + '"><img src="'+getBaseUrl() + '/img/read.png' + '"alt="查看" title="查看"/></a> '+
                                        '<a href="'+getBaseUrl()+'/teacher/book/' + d.sBookId + '?type=update' + '"><img src="'+getBaseUrl() + '/img/xiugai.png' + '"alt="修改" title="修改"/></a>'+
                                    '</div>';
                        }
                    }
                ];
                options = {
                    url: BOOK_LIST_URL,
                    elem: '#bookTable', //id选择器
                    height: 300,
                    even: true,
                    limit: 5,//默认页大小
                    limits: [5,10,20,25],
                    page: {
                        layout: ['limit', 'count', 'prev', 'page', 'next', 'skip'] //自定义分页布局
                        ,groups: 1 //只显示 1 个连续页码
                        ,first: false //不显示首页
                        ,last: false //不显示尾页
                    },
                    request: {
                        pageName: 'pageNum' //页码的参数名称，默认：page
                        ,limitName: 'pageSize' //每页数据量的参数名，默认：limit
                    },response: {
                        statusName: 'code' //规定数据状态的字段名称，默认：code
                        ,statusCode: 0 //规定成功的状态码，默认：0
                        ,msgName: 'msg' //规定状态信息的字段名称，默认：msg
                        ,countName: 'total' //规定数据总数的字段名称，默认：count
                        ,dataName: 'data' //规定数据列表的字段名称，默认：data
                    },
                    parseData: function(res){
                        return res;
                    },
                    cols: [cols]
                };
                bookListTable.render(options);
            });
        },
        search = function(){
            options.url = BOOK_SEARCH_URL + "?" + $('#bookListForm').serialize();
            bookListTable.reload("bookTable",options);
        };
        bootPage();
    });
</script>
</body>
</html>